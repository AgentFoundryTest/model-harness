[pytest]
# Pytest configuration for MLX experiment harness

# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Directory patterns
testpaths = tests

# Output options
addopts =
    # Verbose output showing test names
    -v
    # Show local variables in tracebacks
    -l
    # Show summary of all test outcomes
    -ra
    # Strict markers (fail on unknown markers)
    --strict-markers
    # Strict config (fail on unknown config options)
    --strict-config
    # Show warnings
    -W default

# Markers for categorizing tests
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests
    unit: marks tests as unit tests
    determinism: marks tests that verify deterministic behavior

# Timeout settings (prevent hanging tests)
# Enable for CI environments or when tests may hang due to external dependencies
# Uncomment if pytest-timeout is installed
# timeout = 300
# timeout_method = thread

# Coverage options (if pytest-cov is installed)
# Uncomment to enable coverage reporting
# addopts = --cov=mlx --cov-report=html --cov-report=term

# Temporary directory settings
# pytest will automatically clean up temporary directories after test completion
# tmp_path fixture provides a unique temporary directory per test
# Set to 3 to keep temp dirs from last 3 test sessions for debugging
tmp_path_retention_count = 0
tmp_path_retention_policy = none

# Logging
log_cli = false
log_cli_level = INFO
log_file = pytest.log
log_file_level = DEBUG

# Filtering warnings
filterwarnings =
    # Example: treat specific warnings as errors (comment out during development)
    # error::UserWarning
    # Ignore specific warnings from dependencies or expected warnings
    ignore::DeprecationWarning
    # Allow specific warnings from our code that are intentional
    default::UserWarning:mlx.models.linear
    default::UserWarning:mlx.models.mlp

# Note on floating point comparison tolerance:
# Tests use numpy.testing functions with appropriate tolerances:
# - assert_array_equal for exact deterministic comparisons
# - assert_allclose with rtol=1e-9, atol=1e-12 for strict tests
# - assert_allclose with rtol=1e-6, atol=1e-8 for acceptable numerical variance

